<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>널북이 절주 챗봇</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<style>
  html, body { margin:0; padding:0; height:100%; background:#fafbfe; }
  body { font-family:"Apple SD Gothic Neo", "Malgun Gothic", Arial, sans-serif; }
  #root {
    width:90vw; max-width:480px; min-width:320px; min-height:100vh;
    background:#fff; margin:0 auto; box-sizing:border-box;
    display:flex; flex-direction:column; padding-bottom:7vw;
  }
  #start-screen { display:flex; flex-direction:column; align-items:center;
    justify-content:flex-start; min-height:100vh;
    background:#fafbfe; position:fixed; left:0; top:0; width:100vw; height:100vh; z-index:10;
    transition:opacity .28s; padding-top:11vh; box-sizing:border-box;
  }
  @media (max-width:500px) { #start-screen { padding-top:7vh; } }
  #start-logo { width:24vw; max-width:100px; min-width:72px; height:24vw; max-height:100px; min-height:72px;
    border-radius:50%; object-fit:cover; border:4px solid #ecf0fa; background:#e6f1fb; margin-bottom:24px;
    box-shadow:0 6px 24px rgba(52,142,230,0.1);}
  #start-title { font-size:4.1vw; font-weight:700; color:#23437f; margin-bottom:6vw; text-align:center;
    letter-spacing:-0.35px; max-width:86vw; line-height:1.6; }
  #start-form { width:85vw; max-width:330px;
    display:flex; flex-direction:column; gap:13px; align-items:center;
    margin-top:0;}
  #start-name-input { width:100%; padding:2.3vw; font-size:3.6vw; border-radius:10px; border:1.1px solid #d6daf4;
    background:#f8fafd; outline:none; transition:border .16s;}
  #start-name-input:focus { border-color:#98bff6; }
  #start-btn { width:100%; background:#365eee; color:#fff; border:none; border-radius:10px;
    padding:2.2vw 0; font-size:3.7vw; font-weight:600; cursor:pointer; transition:background 0.18s;}
  #start-btn:disabled { background:#c8d5f8; color:#bbc6db; cursor:not-allowed;}
  #profile-bar { display:flex; align-items:center; padding:4vw 4vw 2vw 4vw; border-bottom:1px solid #e7edf9; background:#f6f8fc; }
  #profile-pic { width:12vw; height:12vw; min-width:42px; min-height:42px; border-radius:50%; background:#e3e7ef;
    object-fit:cover; border:2px solid #ebebec; margin-right:3vw;}
  #profile-info { display:flex; flex-direction:column; gap:0.42vw;}
  #profile-info span:first-child { font-weight:700; font-size:4.8vw; color:#23437f; letter-spacing:-0.5px;}
  #profile-info span:last-child { font-size:3.1vw; color:#6c789d; letter-spacing:-0.5px;}
  #chatbox { flex:1 1 0%; background:#f8f9fb; border-radius:12px; padding:4vw 2vw 3vw 2vw; margin:1.5vw 0 0 0;
    min-height:330px; max-height:70vh; overflow-y:auto; display:flex; flex-direction:column; gap:2vw; font-size:3.7vw;}
  .msg-wrap { width:100%; display:flex; margin-bottom:.5vw;}
  .msg-wrap.bot { flex-direction:row; justify-content:flex-start; }
  .msg-wrap.user { flex-direction:row-reverse; justify-content:flex-end; }
  .message { max-width:65vw; padding:2vw 4vw; border-radius:19px; line-height:1.5; font-size:3.55vw;
    word-break:break-word; box-shadow:0 1px 4px rgba(180,188,204,0.05);
    letter-spacing:-0.3px; margin:0 1vw; display:inline-block;}
  .msg-wrap.bot .message { background:#e6f1fb; color:#14447e; border-bottom-left-radius:0; margin-right:0; margin-left:0.2vw;}
  .msg-wrap.user .message { background:#d9f1e8; color:#146138; border-bottom-right-radius:0; margin-left:auto; margin-right:0;}
  .msg-pic { width:8vw; height:8vw; min-width:28px; min-height:28px; border-radius:50%;
    object-fit:cover; border:1.6px solid #e4e5ea; background:#eee; align-self:flex-end; margin-right: 0.8vw;}
  #choices { width:100%; max-width:100%; box-sizing:border-box;
    margin:0; margin-top:1.6vw; display:flex; flex-direction:column; gap:1.3vw; padding:0 0.5vw; }
  .choice-btn { border:none; border-radius:10px; background:#f2f5fa; color:#39406a;
    font-size:3.3vw; font-weight:500; padding:2vw 0; width:100%; box-sizing:border-box; cursor:pointer;
    box-shadow:0 1px 4px rgba(90,120,240,0.04); letter-spacing:-0.5px; transition:background 0.12s; display:block; margin:0; }
  .choice-btn:hover, .choice-btn:focus { background:#e7edfb; outline:none; }
  @media (min-width:430px) {
    #root{max-width:430px;} #chatbox{font-size:18px;} .message{font-size:17px;}
    #start-title{font-size:20px;} #start-name-input{font-size:16px; padding:9px;}
    #start-btn{font-size:16px;} .choice-btn{font-size:16.5px;}
    #profile-info span:first-child{font-size:22px;} #profile-info span:last-child{font-size:14px;}
    .msg-pic{width:33px;height:33px;}
  }
</style>
</head>
<body>
<div id="root">
  <div id="start-screen">
    <img src="1.png" id="start-logo" alt="널북이 프로필" />
    <div id="start-title">안녕하세요! 금주책방 마스코트 널북이입니다.<br>상담자님 이름을 말해주세요!</div>
    <form id="start-form" autocomplete="off">
      <input type="text" id="start-name-input" placeholder="이름" maxlength="10" autocomplete="off" />
      <button id="start-btn" type="submit" disabled>시작</button>
    </form>
  </div>
  <div id="profile-bar">
    <img src="1.png" alt="널북이 프로필" id="profile-pic" />
    <div id="profile-info">
      <span>널북이</span>
      <span>건강한 절주, 응원해요!</span>
    </div>
  </div>
  <div id="chatbox"></div>
  <div id="choices" style="display:none;"></div>
</div>
<script>
const startScreen = document.getElementById('start-screen');
const startNameInput = document.getElementById('start-name-input');
const startBtn = document.getElementById('start-btn');
const startForm = document.getElementById('start-form');
const chatbox = document.getElementById('chatbox');
const choicesDiv = document.getElementById('choices');
let userName = '';

function updateStartBtn() {
  startBtn.disabled = startNameInput.value.trim() === '';
}
startNameInput.addEventListener('input', updateStartBtn);
startNameInput.addEventListener('keyup', updateStartBtn);
startNameInput.addEventListener('change', updateStartBtn);
updateStartBtn();

startNameInput.addEventListener('focus', () => {
  setTimeout(() => {
    startScreen.scrollIntoView({behavior: 'smooth', block: 'start'});
  }, 100);
});

startForm.onsubmit = e => {
  e.preventDefault();
  if (startNameInput.value.trim() === '') return;
  userName = startNameInput.value.trim();
  startScreen.style.display = 'none';
  appendMessage('bot', `반가워요, ${userName}님! 금주책방 마스코트 널북이입니다. 궁금한 점이 있으면 언제든 말씀해 주세요.`);
  botAsk('start');
};

function appendMessage(sender, text) {
  const wrap = document.createElement('div');
  wrap.className = `msg-wrap ${sender}`;
  if (sender === 'bot') {
    const pic = document.createElement('img');
    pic.className = 'msg-pic';
    pic.src = "1.png";
    pic.alt = '널북이';
    wrap.appendChild(pic);
    const msg = document.createElement('div');
    msg.className = 'message bot';
    msg.textContent = text;
    wrap.appendChild(msg);
  } else {
    const msg = document.createElement('div');
    msg.className = 'message user';
    msg.textContent = text;
    wrap.appendChild(msg);
  }
  chatbox.appendChild(wrap);
  chatbox.scrollTop = chatbox.scrollHeight;
}
function showChoices(choiceArr) {
  choicesDiv.innerHTML = '';
  choicesDiv.style.display = 'flex';
  choiceArr.forEach(choice => {
    const btn = document.createElement('button');
    btn.className = 'choice-btn';
    btn.textContent = choice.text;
    btn.onclick = () => onUserChoice(choice);
    choicesDiv.appendChild(btn);
  });
}
function onUserChoice(choice) {
  appendMessage('user', choice.text);
  choicesDiv.style.display = 'none';
  setTimeout(() => {
    if (choice.next) {
      botAsk(choice.next);
    } else {
      botAsk('end');
    }
  }, 360);
}
function botAsk(key) {
  const b = botDialog[key];
  if (!b) return appendMessage('bot','죄송하지만, 잠시 오류가 발생했습니다.');
  appendMessage('bot', b.text.replace(/{userName}/g, userName));
  if (b.choices && b.choices.length > 0) {
    showChoices(b.choices);
  } else {
    choicesDiv.style.display = 'none';
  }
}

// === 대화 시나리오 ===
const botDialog = {
  start: {
    text: '{userName}님, 안녕하세요! 무엇이 궁금하신가요?',
    choices: [
      { text: '요즘 내 음주 습관 좀 알려줘', next: 'check_habit' },
      { text: '절주에 도움 되는 방법 알려줘', next: 'learn_methods' },
      { text: '술 대신 건강한 취미 추천해줘', next: 'hobby1' }
    ]
  },
  check_habit: {
    text: '{userName}님, 최근 한 달간 술을 얼마나 자주, 얼마나 드셨는지 말씀해주실 수 있을까요?',
    choices: [
      { text: '거의 매일 마셨어', next: 'risk_info' },
      { text: '일주일에 한두 번 마셨어', next: 'normal_week' },
      { text: '한 달에 한두 번밖에 안 마셨어', next: 'tips_maintain' }
    ]
  },
  risk_info: {
    text: '{userName}님은 지금 과음하고 있어요. 과음은 건강에 좋지 않답니다. 어떤 정보가 필요하신가요?',
    choices: [
      { text: '건강이 어떻게 나빠져?', next: 'health_impact' },
      { text: '절주 실천 방법 자세히 알려줘', next: 'learn_methods' },
      { text: '도움 받을 수 있는 기관 추천해줘', next: 'org_recommend' }
    ]
  },
  normal_week: {
    text: '주 1~2회의 음주도, 간 건강이나 수면에 영향을 줄 수 있어요, {userName}님. 혹시 피곤함이나 숙면 어려움을 겪고 계신가요? 건강한 절주 습관을 위해 어떤 것이 가장 궁금하세요?',
    choices: [
      { text: '절주 실천법 알려줘', next: 'learn_methods' },
      { text: '술 줄이는 데 도움이 되는 기관 있으면 추천해줘', next: 'org_recommend' },
      { text: '술 대신 할 만한 취미 뭐가 있어?', next: 'hobby1' }
    ]
  },
  health_impact: {
    text: '음주는 간경화, 고혈압, 암, 치매 등 다양한 건강 문제를 일으킬 수 있답니다. {userName}님께 꼭 필요한 실천법, 혹은 기관 안내도 바로 도와드릴 수 있어요!',
    choices: [
      { text: '절주 실천법 알려줘', next: 'learn_methods' },
      { text: '공식 기관에서 상담을 받고 싶어', next: 'org_detail' },
      { text: '다시 처음으로 돌아갈래', next: 'start' }
    ]
  },
  more_health: {
    text: '보건복지부와 한국건강증진개발원의 연구에 따르면, 습관적 음주는 암, 심장질환뿐 아니라 정신 건강까지 영향을 끼쳐요. {userName}님! 더 궁금한게 있나요? 알려주시면 안내해드릴게요.',
    choices: [
      { text: '절주 방법 더 알려줘', next: 'learn_methods' },
      { text: '상담기관 추천해줘', next: 'org_recommend' },
      { text: '취미 추천해줘', next: 'hobby1' }
    ]
  },
  org_recommend: {
    text: '중독관리통합지원센터에서는 {userName}님의 절주와 금주를 실천하게 도와줍니다. 또 한국건강증진개발원과 보건복지부에서도 많은 도움을 받을 수 있습니다! 도움이 궁금하면 전화번호나 자세한 기관 안내를 이어 드릴까요?',
    choices: [
      { text: '응 더 안내해줘!', next: 'org_detail' },
      { text: '절주 실천법 바로 보고 싶어', next: 'learn_methods' },
      { text: '내 절주 목표 한 번 더 세워볼래', next: 'set_goal' }
    ]
  },
  org_detail: {
    text: '중독관리통합지원센터 전국 어디서나 1393로 무료로 전화 상담을 받을 수 있습니다. 한국건강증진개발원에서도 지역 센터 정보를 확인할 수 있습니다. 필요하실 때 언제든 이용해 보세요!',
    choices: [
      { text: '절주 실천법 알려줘', next: 'learn_methods' },
      { text: '내 목표 다시 정할래', next: 'set_goal' },
      { text: '다시 처음부터 시작할래', next: 'start' }
    ]
  },
  set_goal: {
    text: '{userName}님, 금주/절주 목표를 함께 정해보면 어떨까요?',
    choices: [
      { text: '일주일에 한 번만 마실래', next: 'goal_tips' },
      { text: '이번 달은 금주 도전!', next: 'goal_tips' },
      { text: '취미 추천해줘', next: 'hobby1' }
    ]
  },
  goal_tips: {
    text: '작은 목표부터 세우고 달성 과정을 기록하시면 자신감이 쑥쑥 올라갈 거예요! {userName}님, 실천할 때 제일 궁금한 점은 무엇이신가요?',
    choices: [
      { text: '실천 팁을 더 알려줘', next: 'reduction_tips' },
      { text: '스트레스 관리 비법 알려줘', next: 'stress1' },
      { text: '도움 받을 기관 다시 안내해줘', next: 'org_recommend' }
    ]
  },
  hobby1: {
    text: '{userName}님, 운동이나 요리, 산책, 음악 감상 등 해보고 싶은 취미가 있으세요?',
    choices: [
      { text: '운동에 관심이 있어! 운동은 어때?', next: 'hobby_sport' },
      { text: '집에서 할만한 거 알려줘', next: 'hobby_home' },
      { text: '특별한 취미 알려줘', next: 'hobby_special' }
    ]
  },
  hobby_sport: {
    text: '운동은 스트레스도 풀어주고 절주에도 정말 좋아요! {userName}님은 달리기, 산책, 자전거, 팀 스포츠 혹시 해본 적 있나요?',
    choices: [
      { text: '걷기나 달리기 해볼게', next: 'encourage' },
      { text: '피트니스나 홈트 관심 있어', next: 'encourage' },
      { text: '요가·스트레칭이 더 편할 것 같아', next: 'encourage' }
    ]
  },
  hobby_home: {
    text: '집에서는 독서나 명상 요리를 할 수 있어요! {userName}님은 어디에 관심이 있나요?',
    choices: [
      { text: '요리 도전해볼래', next: 'encourage' },
      { text: '명상에 관심이 있어', next: 'relaxation_techniques' },
      { text: '독서에 관심이 있어', next: 'encourage' }
    ]
  },
  hobby_special: {
    text: '디지털 드로잉, 승마, 양모펠트 같은 특별한 활동도 적극 추천드려요! {userName}님은 어떤 것에 호기심이 있으세요?',
    choices: [
      { text: '디지털 드로잉 재밌겠다! 활동 해보고 싶어', next: 'encourage' },
      { text: '승마 재밌을꺼 같아! 나중에 해봐야겠어', next: 'encourage' },
      { text: '양모펠트 할래', next: 'encourage' }
    ]
  },
  learn_methods: {
    text: '{userName}님, 실천법은 작게 시작해서 꾸준함을 유지하는 게 제일 중요합니다. 어떤 부분이 가장 도움될까요?',
    choices: [
      { text: '단계별로 알려줘', next: 'step_guide' },
      { text: '주변 환경 조성법 궁금해', next: 'environment_tips' },
      { text: '기관 상담 안내해줘', next: 'org_recommend' }
    ]
  },
  step_guide: {
    text: '술자리를 최소화하고, 음주 양을 기록하고, 나에게 맞는 대체 활동을 찾으세요. {userName}님이 더 궁금한게 있으시면 언제든 질문해 주세요.',
    choices: [
      { text: '더 자세히 듣고 싶어', next: 'more_tips' },
      { text: '바로 실천 시작할래', next: 'review' },
      { text: '취미 추천도 해줘', next: 'hobby1' }
    ]
  },
  environment_tips: {
    text: '{userName}님의 주변 사람들에게 술자리보다 산책, 취미 모임, 카페에서 만남을 제안하거나, 주위에 절주 목표를 미리 밝혀두는 게 큰 도움이 될꺼에요',
    choices: [
      { text: '가족, 친구와 미리 약속할래', next: 'peer_sharing' },
      { text: '기관 상담도 도움될까?', next: 'org_recommend' },
      { text: '스트레스부터 관리하고 싶어', next: 'stress1' }
    ]
  },
  reduction_tips: {
    text: '{userName}님, 절주 실천에는 술을 마신 날을 기록하는 것도, 친한 사람에게 결심을 미리 알리는 것도 모두 큰 도움이 됩니다! 혹시 기관 상담도 같이 받아보고 싶으세요?',
    choices: [
      { text: '기관 추천 도와줘', next: 'org_recommend' },
      { text: '목표 다시 세울래', next: 'set_goal' },
      { text: '취미 다시 추천해줘', next: 'hobby1' }
    ]
  },
  peer_sharing: {
    text: '{userName}님, 친구나 가족과 함께 목표를 공유하면 혼자할 때보다 훨씬 더 힘이 돼요. 또 {userName}님 곁에는 한국건강증진개발원이나 1393 센터도 있습니다!',
    choices: [
      { text: '알겠어..! 기관에 대한 정보를 더 알려줘!', next: 'org_recommend' },
      { text: '친구랑 꼭 해볼게', next: 'encourage' },
      { text: '그래도 혼자 해볼래', next: 'review' }
    ]
  },
  review: {
    text: '{userName}님, 요즘 절주나 금주 실천에서 힘든 부분이 있었나요?',
    choices: [
      { text: '생각보다 잘 됐어', next: 'encourage' },
      { text: '스트레스 때문에 힘들었어', next: 'more_tips' },
      { text: '약속대로 못 지켰어', next: 'encourage' }
    ]
  },
  more_tips: {
    text: '{userName}님, 매일 규칙적인 운동, 스트레스 일기, 명상, 호흡법같은 다양한 방법을 실천할 수 있어요. 어떤 게 제일 궁금하세요?',
    choices: [
      { text: '명상, 호흡법 듣고 싶어', next: 'relaxation_techniques' },
      { text: '운동 추천해줘', next: 'encourage' },
      { text: '상담기관 정보다시 설명해줘', next: 'org_recommend' }
    ]
  },
  relaxation_techniques: {
    text: '의자에 앉아 천천히 숨을 들이마시고, 내쉬기를 다섯 번 반복하는 심호흡부터 시작해 보세요. 마음이 진정되면서 스트레스 관리에 정말 효과적입니다. {userName}님께서도 한 번 실천해보시겠어요?',
    choices: [
      { text: '응, 바로 해볼게', next: 'review' },
      { text: '설명 더 듣고 싶어', next: 'more_tips' },
      { text: '이제 상담 끝낼래', next: 'end' }
    ]
  },
  family_talk: {
    text: '{userName}님, 가족과 대화가 어렵게 느껴진다면 기관 자료를 참고하거나, 짧게 문자·메모를 전해보셔도 되고요. 필요한 조언 있으세요?',
    choices: [
      { text: '기관 자료나 예시 좀 보여줘', next: 'org_recommend' },
      { text: '아니, 나 혼자 해볼게', next: 'review' },
      { text: '상담 종료할래', next: 'end' }
    ]
  },
  indirect_contact: {
    text: '편지, 메모, 문자 등으로 가족에게 내 마음을 전하면 의외로 큰 힘이 될 수 있습니다, {userName}님. 다음에는 어떤 목표를 세워보고 싶으신가요?',
    choices: [
      { text: '응, 그렇게 해볼게', next: 'encourage' },
      { text: '다음에 할게', next: 'review' },
      { text: '이제 마칠래', next: 'end' }
    ]
  },
  encourage: {
    text: '{userName}님, 정말 대단하세요! 작은 실천이 모이고 습관이 되면 건강도, 마음도 달라져요. 다음엔 무엇을 함께 해볼까요?',
    choices: [
      { text: '목표를 다시 세울래', next: 'set_goal' },
      { text: '이제 상담 마칠래', next: 'end' },
      { text: '실천법 한 번 더 알려줘', next: 'step_guide' }
    ]
  },
  tips_maintain: {
    text: '지금처럼 좋은 습관을 쭉 이어가시면 건강에 큰 도움이 됩니다! {userName}님, 궁금한 점이 또 있으세요?',
    choices: [
      { text: '절주 팁 더 알려줘', next: 'reduction_tips' },
      { text: '취미 더 추천해줘', next: 'hobby1' },
      { text: '기관 정보 궁금해', next: 'org_recommend' }
    ]
  },
  reduction_tips: {
    text: '하루 술 마신 양 기록하기, 음주 대신 산책하기, 가족이나 친구에게 목표 공유하기가 있어요! {userName}님, 절주 실천에 도움이 될 만한 팁을 더 안내해 드릴까요?',
    choices: [
      { text: '목표 다시 세울래', next: 'set_goal' },
      { text: '취미 추천해줘', next: 'hobby1' },
      { text: '기관 안내 부탁해', next: 'org_recommend' }
    ]
  },
  stress1: {
    text: '{userName}님, 평소 스트레스를 풀고 싶으실 때 어떤 방법이 궁금하세요?',
    choices: [
      { text: '명상이나 호흡법이 궁금해', next: 'relaxation_techniques' },
      { text: '산책이나 운동은 어때?', next: 'encourage' },
      { text: '상담은 여기까지 할래', next: 'end' }
    ]
  },
  end: {
    text: '{userName}님, 오늘 상담은 여기까지입니다. 언제든 궁금한 점이나 도움이 필요하면 다시 찾아와 주세요!',
    choices: []
  }
};
</script>
</body>
</html>
